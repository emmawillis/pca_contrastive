ARGS: Namespace(checkpoint=PosixPath('/project/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune/work_dir/MedSAM/medsam_vit_b.pth'), images_dir=PosixPath('/project/aip-medilab/ewillis/picai_baseline/picai_baseline/workdir/nnUNet_raw_data/Task2203_picai_baseline/imagesTr'), marksheet_csv=PosixPath('/project/aip-medilab/ewillis/pca_contrastive/mri_data/marksheet_folds.csv'), train_folds=['fold1', 'fold2', 'fold3', 'fold4'], val_folds=['fold0'], epochs=20, batch_size=1, lr=0.0001, weight_decay=0.0001, num_workers=2, proj_dim=128, model_type='vit_b', device=None, out_dir=PosixPath('/project/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune/results'), max_lr_epochs=None)
Using device: cuda
ISUPMedSAM(
  (image_encoder): ImageEncoderViT(
    (patch_embed): PatchEmbed(
      (proj): Conv2d(3, 768, kernel_size=(16, 16), stride=(16, 16))
    )
    (blocks): ModuleList(
      (0-11): 12 x Block(
        (norm1): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
        (attn): Attention(
          (qkv): Linear(in_features=768, out_features=2304, bias=True)
          (proj): Linear(in_features=768, out_features=768, bias=True)
        )
        (norm2): LayerNorm((768,), eps=1e-06, elementwise_affine=True)
        (mlp): MLPBlock(
          (lin1): Linear(in_features=768, out_features=3072, bias=True)
          (lin2): Linear(in_features=3072, out_features=768, bias=True)
          (act): GELU(approximate='none')
        )
      )
    )
    (neck): Identity()
  )
  (projector): ABMILProjector(
    (attn_fc): Sequential(
      (0): Linear(in_features=768, out_features=256, bias=True)
      (1): Tanh()
    )
    (attn_score): Linear(in_features=256, out_features=1, bias=True)
    (embed_head): Sequential(
      (0): Linear(in_features=768, out_features=128, bias=True)
      (1): ReLU()
      (2): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
    )
  )
  (classifier): Linear(in_features=128, out_features=6, bias=True)
)
Training cases: 1200, Validation cases: 300
Class weights: tensor([0.1082, 0.4218, 0.3992, 0.9398, 2.3201, 1.8108], device='cuda:0')
Epoch 1/20 | Train Loss: 1.3178, Train Acc: 0.5642 | Val Loss: 1.3332, Val Acc: 0.5367, Val AUC: nan, Val Balanced Acc: 0.1667 | Val Class Acc: {0: 1.0, 1: 0.0, 2: 0.0, 3: 0.0, 4: 0.0, 5: 0.0} 
Saved best model to /project/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune/results
Epoch 2/20 | Train Loss: 1.2964, Train Acc: 0.5717 | Val Loss: 1.3498, Val Acc: 0.5367, Val AUC: nan, Val Balanced Acc: 0.1667 | Val Class Acc: {0: 1.0, 1: 0.0, 2: 0.0, 3: 0.0, 4: 0.0, 5: 0.0} 
Epoch 3/20 | Train Loss: 1.2956, Train Acc: 0.5717 | Val Loss: 1.3392, Val Acc: 0.5367, Val AUC: nan, Val Balanced Acc: 0.1667 | Val Class Acc: {0: 1.0, 1: 0.0, 2: 0.0, 3: 0.0, 4: 0.0, 5: 0.0} 
Epoch 4/20 | Train Loss: 1.2918, Train Acc: 0.5717 | Val Loss: 1.3233, Val Acc: 0.5367, Val AUC: nan, Val Balanced Acc: 0.1667 | Val Class Acc: {0: 1.0, 1: 0.0, 2: 0.0, 3: 0.0, 4: 0.0, 5: 0.0} 
Epoch 5/20 | Train Loss: 1.2880, Train Acc: 0.5700 | Val Loss: 1.3308, Val Acc: 0.5367, Val AUC: nan, Val Balanced Acc: 0.1667 | Val Class Acc: {0: 1.0, 1: 0.0, 2: 0.0, 3: 0.0, 4: 0.0, 5: 0.0} 
Epoch 6/20 | Train Loss: 1.2842, Train Acc: 0.5717 | Val Loss: 1.3458, Val Acc: 0.5367, Val AUC: nan, Val Balanced Acc: 0.1667 | Val Class Acc: {0: 1.0, 1: 0.0, 2: 0.0, 3: 0.0, 4: 0.0, 5: 0.0} 
Epoch 7/20 | Train Loss: 1.2785, Train Acc: 0.5717 | Val Loss: 1.3179, Val Acc: 0.5367, Val AUC: nan, Val Balanced Acc: 0.1667 | Val Class Acc: {0: 1.0, 1: 0.0, 2: 0.0, 3: 0.0, 4: 0.0, 5: 0.0} 
Epoch 8/20 | Train Loss: 1.2626, Train Acc: 0.5700 | Val Loss: 1.3218, Val Acc: 0.5367, Val AUC: nan, Val Balanced Acc: 0.1667 | Val Class Acc: {0: 1.0, 1: 0.0, 2: 0.0, 3: 0.0, 4: 0.0, 5: 0.0} 
Epoch 9/20 | Train Loss: 1.2427, Train Acc: 0.5708 | Val Loss: 1.3180, Val Acc: 0.5367, Val AUC: nan, Val Balanced Acc: 0.1667 | Val Class Acc: {0: 1.0, 1: 0.0, 2: 0.0, 3: 0.0, 4: 0.0, 5: 0.0} 
Epoch 10/20 | Train Loss: 1.1977, Train Acc: 0.5800 | Val Loss: 1.3360, Val Acc: 0.5300, Val AUC: nan, Val Balanced Acc: 0.1906 | Val Class Acc: {0: 0.9130434782608695, 1: 0.23076923076923078, 2: 0.0, 3: 0.0, 4: 0.0, 5: 0.0} 
Saved best model to /project/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune/results
Epoch 11/20 | Train Loss: 1.1344, Train Acc: 0.5933 | Val Loss: 1.3795, Val Acc: 0.5100, Val AUC: nan, Val Balanced Acc: 0.1606 | Val Class Acc: {0: 0.9440993788819876, 1: 0.019230769230769232, 2: 0.0, 3: 0.0, 4: 0.0, 5: 0.0} 
Epoch 12/20 | Train Loss: 1.0753, Train Acc: 0.6158 | Val Loss: 1.4256, Val Acc: 0.4633, Val AUC: nan, Val Balanced Acc: 0.1794 | Val Class Acc: {0: 0.7639751552795031, 1: 0.25, 2: 0.0625, 3: 0.0, 4: 0.0, 5: 0.0} 
Epoch 13/20 | Train Loss: 0.9512, Train Acc: 0.6500 | Val Loss: 1.5664, Val Acc: 0.4000, Val AUC: nan, Val Balanced Acc: 0.1787 | Val Class Acc: {0: 0.6024844720496895, 1: 0.11538461538461539, 2: 0.3541666666666667, 3: 0.0, 4: 0.0, 5: 0.0} 
Epoch 14/20 | Train Loss: 0.8150, Train Acc: 0.7017 | Val Loss: 1.5690, Val Acc: 0.4633, Val AUC: nan, Val Balanced Acc: 0.1891 | Val Class Acc: {0: 0.7701863354037267, 1: 0.07692307692307693, 2: 0.1875, 3: 0.1, 4: 0.0, 5: 0.0} 
Epoch 15/20 | Train Loss: 0.6746, Train Acc: 0.7525 | Val Loss: 1.8363, Val Acc: 0.4433, Val AUC: 0.6383, Val Balanced Acc: 0.1751 | Val Class Acc: {0: 0.7204968944099379, 1: 0.28846153846153844, 2: 0.041666666666666664, 3: 0.0, 4: 0.0, 5: 0.0} 
Epoch 16/20 | Train Loss: 0.5714, Train Acc: 0.7825 | Val Loss: 1.9529, Val Acc: 0.4500, Val AUC: nan, Val Balanced Acc: 0.2010 | Val Class Acc: {0: 0.7391304347826086, 1: 0.07692307692307693, 2: 0.20833333333333334, 3: 0.0, 4: 0.0, 5: 0.18181818181818182} 
Saved best model to /project/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune/results
Epoch 17/20 | Train Loss: 0.4889, Train Acc: 0.8133 | Val Loss: 1.9681, Val Acc: 0.4500, Val AUC: nan, Val Balanced Acc: 0.1874 | Val Class Acc: {0: 0.7204968944099379, 1: 0.25, 2: 0.10416666666666667, 3: 0.05, 4: 0.0, 5: 0.0} 
Epoch 18/20 | Train Loss: 0.4237, Train Acc: 0.8575 | Val Loss: 2.0132, Val Acc: 0.4467, Val AUC: nan, Val Balanced Acc: 0.2550 | Val Class Acc: {0: 0.6521739130434783, 1: 0.28846153846153844, 2: 0.16666666666666666, 3: 0.15, 4: 0.0, 5: 0.2727272727272727} 
Saved best model to /project/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune/results
Epoch 19/20 | Train Loss: 0.3791, Train Acc: 0.8850 | Val Loss: 2.0457, Val Acc: 0.4567, Val AUC: nan, Val Balanced Acc: 0.2299 | Val Class Acc: {0: 0.7018633540372671, 1: 0.25, 2: 0.14583333333333334, 3: 0.1, 4: 0.0, 5: 0.18181818181818182} 
Epoch 20/20 | Train Loss: 0.3512, Train Acc: 0.9025 | Val Loss: 2.0461, Val Acc: 0.4567, Val AUC: nan, Val Balanced Acc: 0.2088 | Val Class Acc: {0: 0.7142857142857143, 1: 0.23076923076923078, 2: 0.16666666666666666, 3: 0.05, 4: 0.0, 5: 0.09090909090909091} 
