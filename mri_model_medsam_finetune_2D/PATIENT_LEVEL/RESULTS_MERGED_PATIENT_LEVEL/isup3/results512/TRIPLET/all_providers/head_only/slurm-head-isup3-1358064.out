Host: kn142
/project/6106383/ewillis/pca_contrastive/venv/bin/python
Python 3.11.4
Tue Oct 28 17:12:58 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 570.148.08             Driver Version: 570.148.08     CUDA Version: 12.8     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA L40S                    On  |   00000000:17:00.0 Off |                    0 |
| N/A   37C    P8             34W /  350W |       0MiB /  46068MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+
ARGS: Namespace(manifest='/project/aip-medilab/shared/picai/manifests/slices_manifest.csv', sam_checkpoint='/project/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune/work_dir/MedSAM/medsam_vit_b.pth', encoder_ckpt='/home/ewillis/projects/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune_2D/PATIENT_LEVEL/RESULTS_MERGED_PATIENT_LEVEL/isup3/results512/triplet_logreg_all/ckpt_best.pt', outdir='/home/ewillis/projects/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune_2D/PATIENT_LEVEL/RESULTS_MERGED_PATIENT_LEVEL/isup3/results512/TRIPLET/all_providers/head_only', target='isup3', folds_train='1,2,3', folds_val='0', batch_size=16, epochs=100, lr_head=1e-05, wd=0.0, pos_ratio=0.33, proj_dim=512, train_proj=False, use_skip=False, label6_column='merged_ISUP')
[load_encoder_only] Loaded encoder weights from /home/ewillis/projects/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune_2D/PATIENT_LEVEL/RESULTS_MERGED_PATIENT_LEVEL/isup3/results512/triplet_logreg_all/ckpt_best.pt
[001] head-train: loss 0.6792 || val: loss 0.1110 acc 0.6243 BAL-acc 0.5476 f1 0.3669 | acc[c0]=0.624  acc[c1]=0.737  acc[c2]=0.282 | auc[c0]=0.910  auc[c1]=0.767  auc[c2]=0.778 | macroAUC=0.819 | macroSens=0.548 macroSpec=0.854 | sens[c0]=0.624  sens[c1]=0.737  sens[c2]=0.282 | spec[c0]=0.954  spec[c1]=0.648  spec[c2]=0.960
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    3894    2160     186
    ISUP1      15     255      76
    ISUP2       6      73      31
  ↳ new best (val BAL-acc=0.5476) saved to /home/ewillis/projects/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune_2D/PATIENT_LEVEL/RESULTS_MERGED_PATIENT_LEVEL/isup3/results512/TRIPLET/all_providers/head_only/ckpt_head_best.pt
[002] head-train: loss 0.5289 || val: loss 0.1244 acc 0.6819 BAL-acc 0.5636 f1 0.3876 | acc[c0]=0.685  acc[c1]=0.760  acc[c2]=0.245 | auc[c0]=0.910  auc[c1]=0.805  auc[c2]=0.692 | macroAUC=0.802 | macroSens=0.564 macroSpec=0.870 | sens[c0]=0.685  sens[c1]=0.760  sens[c2]=0.245 | spec[c0]=0.941  spec[c1]=0.709  spec[c2]=0.961
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4276    1772     192
    ISUP1      19     263      64
    ISUP2       8      75      27
  ↳ new best (val BAL-acc=0.5636) saved to /home/ewillis/projects/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune_2D/PATIENT_LEVEL/RESULTS_MERGED_PATIENT_LEVEL/isup3/results512/TRIPLET/all_providers/head_only/ckpt_head_best.pt
[003] head-train: loss 0.5242 || val: loss 0.1319 acc 0.6921 BAL-acc 0.5600 f1 0.3864 | acc[c0]=0.697  acc[c1]=0.737  acc[c2]=0.245 | auc[c0]=0.910  auc[c1]=0.807  auc[c2]=0.635 | macroAUC=0.784 | macroSens=0.560 macroSpec=0.871 | sens[c0]=0.697  sens[c1]=0.737  sens[c2]=0.245 | spec[c0]=0.932  spec[c1]=0.730  spec[c2]=0.952
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4352    1643     245
    ISUP1      22     255      69
    ISUP2       9      74      27
  ↳ no improvement (1/10)
[004] head-train: loss 0.5275 || val: loss 0.1384 acc 0.6744 BAL-acc 0.5578 f1 0.3784 | acc[c0]=0.679  acc[c1]=0.731  acc[c2]=0.264 | auc[c0]=0.909  auc[c1]=0.795  auc[c2]=0.604 | macroAUC=0.770 | macroSens=0.558 macroSpec=0.869 | sens[c0]=0.679  sens[c1]=0.731  sens[c2]=0.264 | spec[c0]=0.943  spec[c1]=0.716  spec[c2]=0.947
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4234    1728     278
    ISUP1      19     253      74
    ISUP2       7      74      29
  ↳ no improvement (2/10)
[005] head-train: loss 0.5222 || val: loss 0.1431 acc 0.6650 BAL-acc 0.5562 f1 0.3732 | acc[c0]=0.668  acc[c1]=0.737  acc[c2]=0.264 | auc[c0]=0.909  auc[c1]=0.793  auc[c2]=0.575 | macroAUC=0.759 | macroSens=0.556 macroSpec=0.865 | sens[c0]=0.668  sens[c1]=0.737  sens[c2]=0.264 | spec[c0]=0.943  spec[c1]=0.711  spec[c2]=0.942
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4169    1759     312
    ISUP1      19     255      72
    ISUP2       7      74      29
  ↳ no improvement (3/10)
[006] head-train: loss 0.5201 || val: loss 0.1429 acc 0.6849 BAL-acc 0.5588 f1 0.3791 | acc[c0]=0.690  acc[c1]=0.723  acc[c2]=0.264 | auc[c0]=0.909  auc[c1]=0.805  auc[c2]=0.559 | macroAUC=0.758 | macroSens=0.559 macroSpec=0.869 | sens[c0]=0.690  sens[c1]=0.723  sens[c2]=0.264 | spec[c0]=0.932  spec[c1]=0.744  spec[c2]=0.931
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4307    1554     379
    ISUP1      23     250      73
    ISUP2       8      73      29
  ↳ no improvement (4/10)
[007] head-train: loss 0.5058 || val: loss 0.1484 acc 0.6918 BAL-acc 0.5637 f1 0.3847 | acc[c0]=0.697  acc[c1]=0.740  acc[c2]=0.255 | auc[c0]=0.909  auc[c1]=0.811  auc[c2]=0.550 | macroAUC=0.757 | macroSens=0.564 macroSpec=0.871 | sens[c0]=0.697  sens[c1]=0.740  sens[c2]=0.255 | spec[c0]=0.932  spec[c1]=0.740  spec[c2]=0.942
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4348    1580     312
    ISUP1      23     256      67
    ISUP2       8      74      28
  ↳ new best (val BAL-acc=0.5637) saved to /home/ewillis/projects/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune_2D/PATIENT_LEVEL/RESULTS_MERGED_PATIENT_LEVEL/isup3/results512/TRIPLET/all_providers/head_only/ckpt_head_best.pt
[008] head-train: loss 0.5040 || val: loss 0.1463 acc 0.7279 BAL-acc 0.5569 f1 0.3974 | acc[c0]=0.739  acc[c1]=0.668  acc[c2]=0.264 | auc[c0]=0.909  auc[c1]=0.806  auc[c2]=0.588 | macroAUC=0.767 | macroSens=0.557 macroSpec=0.879 | sens[c0]=0.739  sens[c1]=0.668  sens[c2]=0.264 | spec[c0]=0.914  spec[c1]=0.779  spec[c2]=0.942
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4614    1332     294
    ISUP1      30     231      85
    ISUP2       9      72      29
  ↳ no improvement (1/10)
[009] head-train: loss 0.5149 || val: loss 0.1515 acc 0.6953 BAL-acc 0.5662 f1 0.3868 | acc[c0]=0.701  acc[c1]=0.734  acc[c2]=0.264 | auc[c0]=0.908  auc[c1]=0.805  auc[c2]=0.550 | macroAUC=0.754 | macroSens=0.566 macroSpec=0.873 | sens[c0]=0.701  sens[c1]=0.734  sens[c2]=0.264 | spec[c0]=0.932  spec[c1]=0.745  spec[c2]=0.941
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4373    1548     319
    ISUP1      23     254      69
    ISUP2       8      73      29
  ↳ new best (val BAL-acc=0.5662) saved to /home/ewillis/projects/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune_2D/PATIENT_LEVEL/RESULTS_MERGED_PATIENT_LEVEL/isup3/results512/TRIPLET/all_providers/head_only/ckpt_head_best.pt
[010] head-train: loss 0.5208 || val: loss 0.1447 acc 0.7070 BAL-acc 0.5579 f1 0.3868 | acc[c0]=0.717  acc[c1]=0.647  acc[c2]=0.309 | auc[c0]=0.908  auc[c1]=0.802  auc[c2]=0.569 | macroAUC=0.759 | macroSens=0.558 macroSpec=0.873 | sens[c0]=0.717  sens[c1]=0.647  sens[c2]=0.309 | spec[c0]=0.919  spec[c1]=0.790  spec[c2]=0.910
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4476    1268     496
    ISUP1      28     224      94
    ISUP2       9      67      34
  ↳ no improvement (1/10)
[011] head-train: loss 0.5025 || val: loss 0.1536 acc 0.6894 BAL-acc 0.5656 f1 0.3830 | acc[c0]=0.694  acc[c1]=0.749  acc[c2]=0.255 | auc[c0]=0.908  auc[c1]=0.811  auc[c2]=0.529 | macroAUC=0.749 | macroSens=0.566 macroSpec=0.871 | sens[c0]=0.694  sens[c1]=0.749  sens[c2]=0.255 | spec[c0]=0.934  spec[c1]=0.743  spec[c2]=0.936
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4329    1556     355
    ISUP1      23     259      64
    ISUP2       7      75      28
  ↳ no improvement (2/10)
[012] head-train: loss 0.4949 || val: loss 0.1542 acc 0.7225 BAL-acc 0.5750 f1 0.4031 | acc[c0]=0.730  acc[c1]=0.731  acc[c2]=0.264 | auc[c0]=0.907  auc[c1]=0.817  auc[c2]=0.553 | macroAUC=0.759 | macroSens=0.575 macroSpec=0.877 | sens[c0]=0.730  sens[c1]=0.731  sens[c2]=0.264 | spec[c0]=0.917  spec[c1]=0.763  spec[c2]=0.952
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4556    1433     251
    ISUP1      29     253      64
    ISUP2       9      72      29
  ↳ new best (val BAL-acc=0.5750) saved to /home/ewillis/projects/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune_2D/PATIENT_LEVEL/RESULTS_MERGED_PATIENT_LEVEL/isup3/results512/TRIPLET/all_providers/head_only/ckpt_head_best.pt
[013] head-train: loss 0.4867 || val: loss 0.1597 acc 0.7034 BAL-acc 0.5692 f1 0.3930 | acc[c0]=0.708  acc[c1]=0.763  acc[c2]=0.236 | auc[c0]=0.907  auc[c1]=0.818  auc[c2]=0.526 | macroAUC=0.750 | macroSens=0.569 macroSpec=0.875 | sens[c0]=0.708  sens[c1]=0.763  sens[c2]=0.236 | spec[c0]=0.930  spec[c1]=0.740  spec[c2]=0.954
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4420    1576     244
    ISUP1      24     264      58
    ISUP2       8      76      26
  ↳ no improvement (1/10)
[014] head-train: loss 0.5239 || val: loss 0.1512 acc 0.7089 BAL-acc 0.5692 f1 0.3925 | acc[c0]=0.716  acc[c1]=0.728  acc[c2]=0.264 | auc[c0]=0.907  auc[c1]=0.815  auc[c2]=0.536 | macroAUC=0.753 | macroSens=0.569 macroSpec=0.874 | sens[c0]=0.716  sens[c1]=0.728  sens[c2]=0.264 | spec[c0]=0.921  spec[c1]=0.762  spec[c2]=0.939
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4466    1437     337
    ISUP1      27     252      67
    ISUP2       9      72      29
  ↳ no improvement (2/10)
[015] head-train: loss 0.4976 || val: loss 0.1512 acc 0.6989 BAL-acc 0.5616 f1 0.3865 | acc[c0]=0.706  acc[c1]=0.697  acc[c2]=0.282 | auc[c0]=0.907  auc[c1]=0.799  auc[c2]=0.554 | macroAUC=0.753 | macroSens=0.562 macroSpec=0.872 | sens[c0]=0.706  sens[c1]=0.697  sens[c2]=0.282 | spec[c0]=0.925  spec[c1]=0.755  spec[c2]=0.935
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4408    1484     348
    ISUP1      26     241      79
    ISUP2       8      71      31
  ↳ no improvement (3/10)
[016] head-train: loss 0.5087 || val: loss 0.1530 acc 0.7061 BAL-acc 0.5682 f1 0.3927 | acc[c0]=0.713  acc[c1]=0.728  acc[c2]=0.264 | auc[c0]=0.907  auc[c1]=0.809  auc[c2]=0.543 | macroAUC=0.753 | macroSens=0.568 macroSpec=0.874 | sens[c0]=0.713  sens[c1]=0.728  sens[c2]=0.264 | spec[c0]=0.923  spec[c1]=0.752  spec[c2]=0.945
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4447    1502     291
    ISUP1      26     252      68
    ISUP2       9      72      29
  ↳ no improvement (4/10)
[017] head-train: loss 0.5037 || val: loss 0.1505 acc 0.7016 BAL-acc 0.5602 f1 0.3854 | acc[c0]=0.709  acc[c1]=0.708  acc[c2]=0.264 | auc[c0]=0.907  auc[c1]=0.806  auc[c2]=0.541 | macroAUC=0.751 | macroSens=0.560 macroSpec=0.872 | sens[c0]=0.709  sens[c1]=0.708  sens[c2]=0.264 | spec[c0]=0.923  spec[c1]=0.769  spec[c2]=0.924
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4424    1392     424
    ISUP1      26     245      75
    ISUP2       9      72      29
  ↳ no improvement (5/10)
[018] head-train: loss 0.5208 || val: loss 0.1596 acc 0.6786 BAL-acc 0.5636 f1 0.3803 | acc[c0]=0.682  acc[c1]=0.754  acc[c2]=0.255 | auc[c0]=0.907  auc[c1]=0.803  auc[c2]=0.521 | macroAUC=0.743 | macroSens=0.564 macroSpec=0.867 | sens[c0]=0.682  sens[c1]=0.754  sens[c2]=0.255 | spec[c0]=0.934  spec[c1]=0.723  spec[c2]=0.945
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4255    1683     302
    ISUP1      23     261      62
    ISUP2       7      75      28
  ↳ no improvement (6/10)
[019] head-train: loss 0.5121 || val: loss 0.1583 acc 0.7061 BAL-acc 0.5686 f1 0.3951 | acc[c0]=0.712  acc[c1]=0.749  acc[c2]=0.245 | auc[c0]=0.907  auc[c1]=0.809  auc[c2]=0.534 | macroAUC=0.750 | macroSens=0.569 macroSpec=0.876 | sens[c0]=0.712  sens[c1]=0.749  sens[c2]=0.245 | spec[c0]=0.930  spec[c1]=0.741  spec[c2]=0.956
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4442    1568     230
    ISUP1      25     259      62
    ISUP2       7      76      27
  ↳ no improvement (7/10)
[020] head-train: loss 0.4896 || val: loss 0.1555 acc 0.6915 BAL-acc 0.5626 f1 0.3838 | acc[c0]=0.698  acc[c1]=0.708  acc[c2]=0.282 | auc[c0]=0.907  auc[c1]=0.795  auc[c2]=0.535 | macroAUC=0.746 | macroSens=0.563 macroSpec=0.871 | sens[c0]=0.698  sens[c1]=0.708  sens[c2]=0.282 | spec[c0]=0.932  spec[c1]=0.747  spec[c2]=0.935
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4354    1535     351
    ISUP1      24     245      77
    ISUP2       7      72      31
  ↳ no improvement (8/10)
[021] head-train: loss 0.5003 || val: loss 0.1530 acc 0.7379 BAL-acc 0.5728 f1 0.4079 | acc[c0]=0.749  acc[c1]=0.688  acc[c2]=0.282 | auc[c0]=0.907  auc[c1]=0.807  auc[c2]=0.563 | macroAUC=0.759 | macroSens=0.573 macroSpec=0.881 | sens[c0]=0.749  sens[c1]=0.688  sens[c2]=0.282 | spec[c0]=0.912  spec[c1]=0.785  spec[c2]=0.947
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4672    1296     272
    ISUP1      31     238      77
    ISUP2       9      70      31
  ↳ no improvement (9/10)
[022] head-train: loss 0.5050 || val: loss 0.1509 acc 0.6803 BAL-acc 0.5515 f1 0.3741 | acc[c0]=0.687  acc[c1]=0.676  acc[c2]=0.291 | auc[c0]=0.907  auc[c1]=0.791  auc[c2]=0.532 | macroAUC=0.743 | macroSens=0.552 macroSpec=0.868 | sens[c0]=0.687  sens[c1]=0.676  sens[c2]=0.291 | spec[c0]=0.932  spec[c1]=0.767  spec[c2]=0.904
Confusion matrix (LR val): rows=true, cols=pred
true\pred   ISUP0   ISUP1   ISUP2   ISUP3   ISUP4   ISUP5
    ISUP0    4289    1409     542
    ISUP1      22     234      90
    ISUP2       9      69      32
  ↳ no improvement (10/10)
Early stopping triggered at epoch 22: no BAL-acc improvement for 10 epochs.

=== Final model: Sensitivity at fixed specificity (validation) ===
       class |          AUC |  Sens@Spec80 |  Sens@Spec90 |  Sens@Spec95 |  Sens@Spec97 |  Sens@Spec99
          c0 |        0.907 |        0.854 |        0.771 |        0.608 |        0.501 |        0.391
          c1 |        0.817 |        0.691 |        0.434 |        0.243 |        0.118 |        0.043
          c2 |        0.553 |        0.409 |        0.327 |        0.264 |        0.191 |        0.091
       macro |        0.759 |        0.651 |        0.511 |        0.372 |        0.270 |        0.175
