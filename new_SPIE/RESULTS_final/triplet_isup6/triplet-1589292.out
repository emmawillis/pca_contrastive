Running TRIPLET job
/project/6106383/ewillis/pca_contrastive/venv/bin/python
Python 3.11.4
Wed Dec 10 15:42:26 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 570.148.08             Driver Version: 570.148.08     CUDA Version: 12.8     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA L40S                    On  |   00000000:CA:00.0 Off |                    0 |
| N/A   32C    P8             33W /  350W |       0MiB /  46068MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+
/project/6106383/ewillis/pca_contrastive/venv/lib/python3.11/site-packages/pydantic/_internal/_generate_schema.py:2249: UnsupportedFieldAttributeWarning: The 'repr' attribute with value False was provided to the `Field()` function, which has no effect in the context it was used. 'repr' is field-specific metadata, and can only be attached to a model field using `Annotated` metadata or by assignment. This may have happened because an `Annotated` type alias using the `type` statement was used, or if the `Field()` function was attached to a single member of a union type.
  warnings.warn(
/project/6106383/ewillis/pca_contrastive/venv/lib/python3.11/site-packages/pydantic/_internal/_generate_schema.py:2249: UnsupportedFieldAttributeWarning: The 'frozen' attribute with value True was provided to the `Field()` function, which has no effect in the context it was used. 'frozen' is field-specific metadata, and can only be attached to a model field using `Annotated` metadata or by assignment. This may have happened because an `Annotated` type alias using the `type` statement was used, or if the `Field()` function was attached to a single member of a union type.
  warnings.warn(
SCRIPT: train_triplet_oldSPIE.py
ARGS: Namespace(use_frozen=True, medsam_encodings='/home/ewillis/projects/aip-medilab/shared/picai/picai_medsam_zero_shot_encodings', seed=42, manifest='/project/aip-medilab/shared/picai/manifests/slices_manifest.csv', target='isup6', folds_train='1,2,3', folds_val='0', folds_test='4', batch_size=16, pos_ratio=0.33, use_skip=False, label6_column='merged_ISUP', sam_checkpoint='/project/aip-medilab/ewillis/pca_contrastive/mri_model_medsam_finetune/work_dir/MedSAM/medsam_vit_b.pth', proj_dim=128, strip_neck=False, histo_dir='/home/ewillis/projects/aip-medilab/shared/picai/histopathology_encodings/UNI2/projected_128D/embeddings_128', histo_marksheet_dir='/home/ewillis/projects/aip-medilab/shared/picai/histopathology_encodings/UNI2_splits', provider='all', triplet_epochs=40, triplet_patience=10, triplet_lr=1e-05, triplet_wd=0.0, triplet_margin=0.2, lr_max_iter=15, head_epochs=40, head_patience=10, head_lr=1e-05, head_wd=0.0, train_proj=False, outdir='/home/ewillis/projects/aip-medilab/ewillis/pca_contrastive/new_SPIE/RESULTS_final/triplet_isup6', wandb=True, wandb_project='mri-training', wandb_run_name='newSPIE-triplet-isup6-128D')
wandb: Currently logged in as: jesande7 (jesande7-queens) to https://api.wandb.ai. Use `wandb login --relogin` to force relogin
wandb: WARNING Changes to your `wandb` environment variables will be ignored because your `wandb` session has already started. For more information on how to modify your settings with `wandb.init()` arguments, please refer to https://wandb.me/wandb-init.
wandb: Tracking run with wandb version 0.21.2
wandb: Run data is saved locally in /project/6106383/shared/picai/wandb/run-20251210_154236-afqhyl4h
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run newSPIE-triplet-isup6-128D
wandb: ‚≠êÔ∏è View project at https://wandb.ai/jesande7-queens/mri-training
wandb: üöÄ View run at https://wandb.ai/jesande7-queens/mri-training/runs/afqhyl4h
Traceback (most recent call last):
  File "/home/ewillis/projects/aip-medilab/ewillis/pca_contrastive/new_SPIE/train_triplet_oldSPIE.py", line 641, in <module>
    main()
  File "/home/ewillis/projects/aip-medilab/ewillis/pca_contrastive/new_SPIE/train_triplet_oldSPIE.py", line 303, in main
    w_ce, classes_present, n_classes) = build_datasets_and_loaders(
                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/project/6106383/ewillis/pca_contrastive/new_SPIE/train_utils.py", line 264, in build_datasets_and_loaders
    sampler = make_pos_sampler(train_ds.df, pos_ratio=pos_ratio)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/project/6106383/ewillis/pca_contrastive/new_SPIE/train_utils.py", line 59, in make_pos_sampler
    assert n_pos > 0, "No positive slices in train folds."
           ^^^^^^^^^
AssertionError: No positive slices in train folds.
[1;34mwandb[0m: 
[1;34mwandb[0m: üöÄ View run [33mnewSPIE-triplet-isup6-128D[0m at: [34mhttps://wandb.ai/jesande7-queens/mri-training/runs/afqhyl4h[0m
[1;34mwandb[0m: Find logs at: [1;35mwandb/run-20251210_154236-afqhyl4h/logs[0m
srun: error: kn071: task 0: Exited with exit code 1
